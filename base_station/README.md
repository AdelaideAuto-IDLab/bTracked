# Base Station tool

Responsible for sniffing BLE packets sent by the transmitter back to the server. Currently only the nRF51822 SoC is supported.

## Build guide

1. Install [Rust](https://www.rust-lang.org/en-US/install.html)
2. Build & Run `cargo --release`

Note: `libudev` and `openssl` are required for Linux builds, this requires several manual steps in order to cross-compile, so it is typically easier to build on the target device. However both `libudev` (used for port enumeration) and `openssl` (https support) are not used for critical components of the system so could easily be removed.

## Configuration

The `base_station` is configured with the `config.toml` file. Below is an annotated version of a sample configuration:

```toml
# Controls the logging level (specified using the `env_logger` syntax)
log = "info"

# Specifies how to receive measurements
[source]
type = "serial" # Specifies a nRF51822 module connected via a serial port
# path = "/dev/ttyS1" # Specifies the path to the serial port, if no path is provided, the tool will attempt to detect any connected serial device
version = 1 # There are two nRF51822 sniffer firmware versions, 1 = v1
baud_rate = 921600
data_bits = "8"
stop_bits = "1"
parity = "none"
flow_control = "none"

# Below is an alternative source that reads data from a file.
# Note: only 1 source active at a time. For multiple sources run multiple instances of the tool with the same destination endpoint.
# [source]
# type = "file"
# path = "measurements.jsonl"
# repeat = true

# Specifies how to send the measurement received.
[[destination]]
type = "http"
endpoint = "http://127.0.0.1:8080/api/instance/test/beacon_measurement" # The url the instance to send the measurement to
retry_attempts = 0 # The number of times to retry failed sends
queue_rate_ms = 200 # For efficiency the HTTP endpoint can wait for a short duration and send multiple measurements in a bulk request.

# There can be any number of destination specifications, below we also log to `stddout`
[[destination]]
type = "stdout"

# Files generated by setting a file destination can be replayed using a file source
[[destination]]
type = "file"
path = "measurements.jsonl"
```
